#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—é –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å –ø–ª–∞—Ç–Ω–∏—Ö –∑–∞—è–≤–æ–∫

echo "üöÄ –ü–æ—á–∏–Ω–∞—î–º–æ –¥–µ–ø–ª–æ–π –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å..."

# –ü–µ—Ä–µ—Ö—ñ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –ø—Ä–æ–µ–∫—Ç—É
cd /var/www/sviydlyasvoih/platform-svoi

# –ó—É–ø–∏–Ω–∫–∞ PM2
echo "‚è∏Ô∏è  –ó—É–ø–∏–Ω—è—î–º–æ PM2..."
pm2 stop sviy-platform

# –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É
echo "üì• –û–Ω–æ–≤–ª—é—î–º–æ –∫–æ–¥..."
git pull origin main

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
echo "üì¶ –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ..."
npm install

# –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è Prisma Client
echo "üîß –ì–µ–Ω–µ—Ä—É—î–º–æ Prisma Client..."
npx prisma generate

# –ë—ñ–ª–¥ –ø—Ä–æ–µ–∫—Ç—É
echo "üèóÔ∏è  –ó–±–∏—Ä–∞—î–º–æ –ø—Ä–æ–µ–∫—Ç..."
npm run build

# –ó–∞–ø—É—Å–∫ PM2
echo "‚ñ∂Ô∏è  –ó–∞–ø—É—Å–∫–∞—î–º–æ PM2..."
pm2 start ecosystem.config.js
pm2 save

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤
echo "üìã –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤..."
pm2 logs sviy-platform --lines 20

echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
