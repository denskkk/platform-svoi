# ========================================
# PostgreSQL Configuration для 100+ користувачів
# ========================================
# Розмістіть це в docker-compose.yml або postgresql.conf

# ВАЖЛИВО: Ці налаштування для контейнера з 2GB RAM

# Максимум з'єднань (зв'язано з Prisma connection pool)
# Formula: (num_app_instances * connection_limit) + 10
# Для 1 instance з pool=20: 20 + 10 = 30
max_connections = 100

# Shared buffers (25% від RAM)
# Для 2GB RAM: 512MB
shared_buffers = 512MB

# Effective cache (50-75% від RAM)
# Postgres використовує OS cache
effective_cache_size = 1536MB

# Work memory для сортування/GROUP BY
# Formula: RAM / max_connections
# 2GB / 100 = 20MB
work_mem = 20MB

# Maintenance work memory (для VACUUM, CREATE INDEX)
maintenance_work_mem = 128MB

# Checkpoint segments
wal_buffers = 16MB
checkpoint_completion_target = 0.9

# Query planner
random_page_cost = 1.1  # Для SSD
effective_io_concurrency = 200  # Для SSD

# Logging для діагностики
log_min_duration_statement = 1000  # Логувати запити > 1 секунди
log_connections = on
log_disconnections = on
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# ========================================
# Як застосувати:
# ========================================

# Варіант 1: Docker Compose
# Додайте в docker-compose.yml:
#
# services:
#   postgres:
#     image: postgres:14
#     command:
#       - "postgres"
#       - "-c"
#       - "max_connections=100"
#       - "-c"
#       - "shared_buffers=512MB"
#       - "-c"
#       - "effective_cache_size=1536MB"
#       - "-c"
#       - "work_mem=20MB"

# Варіант 2: Локальний PostgreSQL
# Знайдіть postgresql.conf:
#   Windows: C:\Program Files\PostgreSQL\14\data\postgresql.conf
#   Linux: /etc/postgresql/14/main/postgresql.conf
#   Mac: /usr/local/var/postgres/postgresql.conf
#
# Додайте ці параметри та перезапустіть:
#   sudo systemctl restart postgresql
