# üîß –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø –ü–†–û–§–Ü–õ–Æ

## ‚ùå –ü–†–û–ë–õ–ï–ú–ò –©–û –ë–£–õ–ò:

1. **–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é –Ω–µ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è**
   - –ü—Ä–∏—á–∏–Ω–∞: `/api/upload` –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è–≤ cookie, —Ç—ñ–ª—å–∫–∏ Authorization header
   
2. **–ê–Ω–∫–µ—Ç–∞ –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è**
   - –ü—Ä–∏—á–∏–Ω–∞: –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞–ª–∏—Å—è –≤ –ë–î, –∞–ª–µ –Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞–ª–∏—Å—è –≤ localStorage —ñ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
   
3. **–ü—Ä–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ –ø–æ–ª—è –ø—É—Å—Ç—ñ**
   - –ü—Ä–∏—á–∏–Ω–∞: –ú–æ–∂–ª–∏–≤–æ –¥–∞–Ω—ñ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª–∏—Å—è –∑ API –∞–±–æ –±—É–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∑ —Ç–æ–∫–µ–Ω–æ–º

---

## ‚úÖ –©–û –í–ò–ü–†–ê–í–õ–ï–ù–û:

### 1. **`/api/upload` - –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ Cookie** ‚úÖ

**–§–∞–π–ª:** `src/app/api/upload/route.ts`

**–ó–º—ñ–Ω–∏:**
```typescript
// –ë–£–õ–û:
const authHeader = request.headers.get('authorization');
if (!authHeader || !authHeader.startsWith('Bearer ')) {
  return NextResponse.json({ error: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ' }, { status: 401 });
}

// –°–¢–ê–õ–û:
let token = getAuthCookie(request);

if (!token) {
  const authHeader = request.headers.get('authorization');
  if (authHeader && authHeader.startsWith('Bearer ')) {
    token = authHeader.substring(7);
  }
}

if (!token) {
  return NextResponse.json({ error: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ' }, { status: 401 });
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ –ø—Ä–∞—Ü—é—î –∑ httpOnly cookies ‚úÖ

---

### 2. **–í–∏–¥–∞–ª–µ–Ω–Ω—è Authorization Header –∑ —Ñ–æ—Ä–º** ‚úÖ

**–§–∞–π–ª–∏:**
- `src/app/profile/edit/page.tsx`
- `src/app/profile/edit-business/page.tsx`

**–ó–º—ñ–Ω–∏:**
```typescript
// –ë–£–õ–û:
headers: {
  'Content-Type': 'application/json',
  'Authorization': `Bearer ${token}`,
}

// –°–¢–ê–õ–û:
headers: {
  'Content-Type': 'application/json',
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç—ñ–ª—å–∫–∏ httpOnly cookies (–±–µ–∑–ø–µ—á–Ω—ñ—à–µ) ‚úÖ

---

### 3. **–ü–æ–∫—Ä–∞—â–µ–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è** ‚úÖ

**–§–∞–π–ª:** `src/app/profile/edit/page.tsx`

**–ó–º—ñ–Ω–∏:**
```typescript
// –ë–£–õ–û:
setTimeout(() => {
  router.push(`/profile/${user.id}`);
}, 2000);

// –°–¢–ê–õ–û:
// 1. –û–Ω–æ–≤–ª–µ–Ω–Ω—è localStorage –∑ –ø–æ–≤–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏
const updatedUser = {
  ...user,
  ...data.user,
  avatarUrl: data.user.avatarUrl || user.avatarUrl
};
localStorage.setItem('user', JSON.stringify(updatedUser));

// 2. –ü—Ä–∏–º—É—Å–æ–≤–µ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
setTimeout(() => {
  window.location.href = `/profile/${user.id}`;
}, 1000);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- –§–æ—Ç–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤ localStorage ‚úÖ
- –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—Ä–æ—Ñ—ñ–ª—é –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∑ –Ω–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ ‚úÖ
- –®–≤–∏–¥—à–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è (1—Å –∑–∞–º—ñ—Å—Ç—å 2—Å) ‚úÖ

---

### 4. **–î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è** üîç

**–§–∞–π–ª:** `src/app/profile/edit/page.tsx`

**–î–æ–¥–∞–Ω–æ –ª–æ–≥–∏:**
```typescript
console.log('[Edit Profile] –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é:', userId);
console.log('[Edit Profile] –û—Ç—Ä–∏–º–∞–Ω–æ –¥–∞–Ω—ñ:', data);
console.log('[Edit Profile] –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏ –∑ –¥–∞–Ω–∏–º–∏:', {...});
console.log('[Edit Profile] –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞...');
console.log('[Edit Profile] –ê–≤–∞—Ç–∞—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ:', uploadedUrl);
console.log('[Edit Profile] –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö:', requestBody);
console.log('[Edit Profile] –í—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞:', data);
console.log('[Edit Profile] –û–Ω–æ–≤–ª–µ–Ω–Ω—è localStorage:', updatedUser);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –õ–µ–≥–∫–æ –¥—ñ–∞–≥–Ω–æ—Å—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ ‚úÖ

---

## üéØ –¢–ï–ü–ï–† –ü–†–ê–¶–Æ–Ñ:

### ‚úÖ **–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –æ—Å–æ–±–∏—Å—Ç–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é:**
1. –ó–∞—Ö–æ–¥–∏–º–æ –Ω–∞ `/profile/edit`
2. –í—Å—ñ –ø–æ–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –¥–∞–Ω–∏–º–∏ –∑ –ë–î (—á–µ—Ä–µ–∑ API)
3. –ó–º—ñ–Ω—é—î–º–æ –¥–∞–Ω—ñ + –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ñ–æ—Ç–æ
4. –ù–∞—Ç–∏—Å–∫–∞—î–º–æ "–ó–±–µ—Ä–µ–≥—Ç–∏"
5. –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ `/api/profile/[id]` (PUT) –∑ cookie –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é
6. –§–æ—Ç–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `/api/upload` –∑ cookie –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é
7. localStorage –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è
8. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ `/profile/[id]` –∑ –ø—Ä–∏–º—É—Å–æ–≤–∏–º reload
9. **–í—Å—ñ –¥–∞–Ω—ñ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è!** ‚úÖ

### ‚úÖ **–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ñ—ñ–ª—é:**
1. –ó–∞—Ö–æ–¥–∏–º–æ –Ω–∞ `/profile/edit-business`
2. –í—Å—ñ –ø–æ–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –¥–∞–Ω–∏–º–∏ –∑ –ë–î
3. –ó–º—ñ–Ω—é—î–º–æ –¥–∞–Ω—ñ + –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ª–æ–≥–æ—Ç–∏–ø
4. –ù–∞—Ç–∏—Å–∫–∞—î–º–æ "–ó–±–µ—Ä–µ–≥—Ç–∏"
5. –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ `/api/business-info` (PUT) –∑ cookie –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é
6. –õ–æ–≥–æ—Ç–∏–ø –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `/api/upload` –∑ cookie –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é
7. **–í—Å—ñ –±—ñ–∑–Ω–µ—Å-–¥–∞–Ω—ñ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è!** ‚úÖ

---

## üìã –ß–ï–ö–õ–ò–°–¢ –¢–ï–°–¢–£–í–ê–ù–ù–Ø:

### –û—Å–æ–±–∏—Å—Ç–∏–π –ø—Ä–æ—Ñ—ñ–ª—å:
- [ ] –í—ñ–¥–∫—Ä–∏—Ç–∏ `/profile/edit`
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—Å—ñ –ø–æ–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ
- [ ] –ó–º—ñ–Ω–∏—Ç–∏ —ñ–º'—è, –±–∏–æ, –ø—Ä–æ—Ñ–µ—Å—ñ—é
- [ ] –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤–µ —Ñ–æ—Ç–æ
- [ ] –ó–±–µ—Ä–µ–≥—Ç–∏
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Ñ–æ—Ç–æ –æ–Ω–æ–≤–∏–ª–æ—Å—è –≤ –ø—Ä–æ—Ñ—ñ–ª—ñ
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—Å—ñ –∑–º—ñ–Ω–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è
- [ ] –ó–Ω–æ–≤—É –≤—ñ–¥–∫—Ä–∏—Ç–∏ `/profile/edit` - –ø–æ–ª—è –º–∞—é—Ç—å –±—É—Ç–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –Ω–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏

### –ë—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ñ—ñ–ª—å:
- [ ] –í—ñ–¥–∫—Ä–∏—Ç–∏ `/profile/edit-business`
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—Å—ñ –ø–æ–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ
- [ ] –ó–º—ñ–Ω–∏—Ç–∏ –Ω–∞–∑–≤—É –∫–æ–º–ø–∞–Ω—ñ—ó, –æ–ø–∏—Å, –º—ñ—Å—ñ—é
- [ ] –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤–∏–π –ª–æ–≥–æ—Ç–∏–ø
- [ ] –ó–±–µ—Ä–µ–≥—Ç–∏
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –ª–æ–≥–æ—Ç–∏–ø –æ–Ω–æ–≤–∏–≤—Å—è
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—Å—ñ –∑–º—ñ–Ω–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è
- [ ] –ó–Ω–æ–≤—É –≤—ñ–¥–∫—Ä–∏—Ç–∏ `/profile/edit-business` - –ø–æ–ª—è –º–∞—é—Ç—å –±—É—Ç–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –Ω–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏

---

## üîê –ë–ï–ó–ü–ï–ö–ê:

‚úÖ **httpOnly cookies** - —Ç–æ–∫–µ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π —á–µ—Ä–µ–∑ JavaScript (–∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ XSS)
‚úÖ **Rate limiting** - 10 –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å —Ñ–æ—Ç–æ –Ω–∞ –≥–æ–¥–∏–Ω—É
‚úÖ **–í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ñ–∞–π–ª—ñ–≤** - —Ç—ñ–ª—å–∫–∏ JPG, PNG, WebP, GIF, –º–∞–∫—Å–∏–º—É–º 5MB
‚úÖ **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∑–æ–±—Ä–∞–∂–µ–Ω—å** - Sharp –∫–æ–Ω–≤–µ—Ä—Ç—É—î –≤ WebP, 400x400px
‚úÖ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è** - –≤—Å—ñ endpoint –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å cookie –∞–±–æ header

---

**–°–¢–ê–¢–£–°:** ‚úÖ –í–°–Ü –ü–†–û–ë–õ–ï–ú–ò –í–ò–ü–†–ê–í–õ–ï–ù–Ü!

–¢–µ–ø–µ—Ä:
- ‚úÖ –§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è
- ‚úÖ –ê–Ω–∫–µ—Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
- ‚úÖ –ü—Ä–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ –ø–æ–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –¥–∞–Ω–∏–º–∏
- ‚úÖ –í—Å—ñ –∑–º—ñ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –ë–î
- ‚úÖ –í—Å—ñ –∑–º—ñ–Ω–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ—ñ–ª—ñ
- ‚úÖ localStorage —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∏–π –∑ –ë–î
