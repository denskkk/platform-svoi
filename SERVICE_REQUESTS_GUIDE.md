# –°–∏—Å—Ç–µ–º–∞ –ó–∞—è–≤–æ–∫ —Ç–∞ –í—ñ–¥–≥—É–∫—ñ–≤

## üìã –û–≥–ª—è–¥

–ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞—è–≤–∫–∞–º–∏ –Ω–∞ –ø–æ—Å–ª—É–≥–∏ –∑ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é –£–¶–ú —Ç–∞ –≤—ñ–¥–≥—É–∫–∞–º–∏.

## üöÄ –û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

### –î–ª—è –ö–ª—ñ—î–Ω—Ç—ñ–≤:
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞—è–≤–æ–∫ –∑ –æ–ø–∏—Å–æ–º, —Ñ–æ—Ç–æ, –±—é–¥–∂–µ—Ç–æ–º
- ‚úÖ –ü–µ—Ä–µ–≥–ª—è–¥ —Å—Ç–∞—Ç—É—Å—É –∑–∞—è–≤–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
- ‚úÖ –û–ø–ª–∞—Ç–∞ –≤ –£–¶–ú –ø—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- ‚úÖ –ó–∞–ª–∏—à–∞–Ω–Ω—è –≤—ñ–¥–≥—É–∫—ñ–≤ –∑ —Ä–µ–π—Ç–∏–Ω–≥–æ–º 1-5

### –î–ª—è –í–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤ (–ú–∞–π—Å—Ç—Ä—ñ–≤):
- ‚úÖ –ü–µ—Ä–µ–≥–ª—è–¥ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∑–∞—è–≤–æ–∫
- ‚úÖ –ü—Ä–∏–π–Ω—è—Ç—Ç—è –∑–∞—è–≤–æ–∫ –≤ —Ä–æ–±–æ—Ç—É
- ‚úÖ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å–∞–º–∏ (–í –ø—Ä–æ—Ü–µ—Å—ñ ‚Üí –í–∏–∫–æ–Ω–∞–Ω–æ)
- ‚úÖ –û—Ç—Ä–∏–º–∞–Ω–Ω—è –£–¶–ú –ø—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏
- ‚úÖ –í—ñ–¥–≥—É–∫–∏ —Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥

## üìä –°—Ç–∞—Ç—É—Å–∏ –ó–∞—è–≤–æ–∫

```
new ‚Üí viewed ‚Üí accepted ‚Üí in_progress ‚Üí completed ‚Üí paid
                    ‚Üì
              rejected / cancelled
```

- **new** - –ù–æ–≤–∞ –∑–∞—è–≤–∫–∞ (–∂–æ–≤—Ç–∏–π)
- **viewed** - –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∞ –≤–∏–∫–æ–Ω–∞–≤—Ü–µ–º (—Å–∏–Ω—ñ–π)
- **accepted** - –ü—Ä–∏–π–Ω—è—Ç–∞ –≤ —Ä–æ–±–æ—Ç—É (—Ñ—ñ–æ–ª–µ—Ç–æ–≤–∏–π)
- **in_progress** - –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è (–ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π)
- **completed** - –í–∏–∫–æ–Ω–∞–Ω–∞, —á–µ–∫–∞—î –æ–ø–ª–∞—Ç–∏ (–∑–µ–ª–µ–Ω–∏–π)
- **paid** - –û–ø–ª–∞—á–µ–Ω–∞ (—Ç–µ–º–Ω–æ-–∑–µ–ª–µ–Ω–∏–π)
- **cancelled** - –°–∫–∞—Å–æ–≤–∞–Ω–∞ –∫–ª—ñ—î–Ω—Ç–æ–º (—Å—ñ—Ä–∏–π)
- **rejected** - –í—ñ–¥—Ö–∏–ª–µ–Ω–∞ –≤–∏–∫–æ–Ω–∞–≤—Ü–µ–º (—á–µ—Ä–≤–æ–Ω–∏–π)

## üõ†Ô∏è API Endpoints

### –ó–∞—è–≤–∫–∏

#### POST /api/service-requests
–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞—è–≤–∫—É
```json
{
  "title": "–ü–æ—Ç—Ä—ñ–±–µ–Ω –µ–ª–µ–∫—Ç—Ä–∏–∫",
  "description": "–ó–∞–º—ñ–Ω–∞ –ø—Ä–æ–≤–æ–¥–∫–∏ –≤ –∫–≤–∞—Ä—Ç–∏—Ä—ñ...",
  "category": "–ï–ª–µ–∫—Ç—Ä–∏–∫–∞",
  "city": "–ö–∏—ó–≤",
  "address": "–≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫ 1",
  "budgetFrom": 50,
  "budgetTo": 150,
  "photos": ["url1", "url2"]
}
```

#### GET /api/service-requests?type=my&page=1
–û—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞—è–≤–∫–∏
- `type`: `my` (–º–æ—ó), `available` (–¥–æ—Å—Ç—É–ø–Ω—ñ), `assigned` (–ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –º–µ–Ω—ñ)
- `status`: —Ñ—ñ–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
- `category`: —Ñ—ñ–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
- `city`: —Ñ—ñ–ª—å—Ç—Ä –ø–æ –º—ñ—Å—Ç—É

#### GET /api/service-requests/[id]
–î–µ—Ç–∞–ª—ñ –∑–∞—è–≤–∫–∏

#### PATCH /api/service-requests/[id]
–û–Ω–æ–≤–∏—Ç–∏ –∑–∞—è–≤–∫—É
```json
{
  "action": "accept" | "reject" | "start" | "complete" | "cancel",
  "agreedPrice": 100
}
```

#### POST /api/service-requests/[id]/pay
–û–ø–ª–∞—Ç–∏—Ç–∏ –∑–∞—è–≤–∫—É –≤ –£–¶–ú

### –í—ñ–¥–≥—É–∫–∏

#### POST /api/reviews
–°—Ç–≤–æ—Ä–∏—Ç–∏ –≤—ñ–¥–≥—É–∫
```json
{
  "reviewedId": 123,
  "serviceRequestId": 456,
  "rating": 5,
  "comment": "–í—ñ–¥–º—ñ–Ω–Ω–∞ —Ä–æ–±–æ—Ç–∞!",
  "photos": ["url"]
}
```

#### GET /api/reviews?userId=123&page=1
–û—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–≥—É–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
–ü–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥–≥—É–∫–∏ + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–µ–π—Ç–∏–Ω–≥—ñ–≤ (1-5 –∑—ñ—Ä–æ–∫)

## üí° –ü—Ä–∏–∫–ª–∞–¥ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### 1. –ö–ª—ñ—î–Ω—Ç —Å—Ç–≤–æ—Ä—é—î –∑–∞—è–≤–∫—É
```typescript
const response = await fetch('/api/service-requests', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  credentials: 'include',
  body: JSON.stringify({
    title: '–†–µ–º–æ–Ω—Ç –∫—Ä–∞–Ω—É',
    description: '–ü–æ—Ç—ñ–∫ –≤–æ–¥–∏, —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ',
    category: '–°–∞–Ω—Ç–µ—Ö–Ω—ñ–∫–∞',
    city: '–ö–∏—ó–≤',
    budgetFrom: 30,
    budgetTo: 50
  })
});
```

### 2. –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å –ø—Ä–∏–π–º–∞—î –∑–∞—è–≤–∫—É
```typescript
await fetch(`/api/service-requests/${requestId}`, {
  method: 'PATCH',
  headers: { 'Content-Type': 'application/json' },
  credentials: 'include',
  body: JSON.stringify({
    action: 'accept',
    agreedPrice: 40
  })
});
```

### 3. –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å –∑–∞–≤–µ—Ä—à—É—î —Ä–æ–±–æ—Ç—É
```typescript
await fetch(`/api/service-requests/${requestId}`, {
  method: 'PATCH',
  credentials: 'include',
  body: JSON.stringify({ action: 'complete' })
});
```

### 4. –ö–ª—ñ—î–Ω—Ç –æ–ø–ª–∞—á—É—î
```typescript
await fetch(`/api/service-requests/${requestId}/pay`, {
  method: 'POST',
  credentials: 'include'
});
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ: —Å–ø–∏—Å–∞–Ω–Ω—è –∑ –∫–ª—ñ—î–Ω—Ç–∞, –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–≤—Ü—é
```

### 5. –ö–ª—ñ—î–Ω—Ç –∑–∞–ª–∏—à–∞—î –≤—ñ–¥–≥—É–∫
```typescript
await fetch('/api/reviews', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  credentials: 'include',
  body: JSON.stringify({
    reviewedId: executorId,
    serviceRequestId: requestId,
    rating: 5,
    comment: '–®–≤–∏–¥–∫–æ —ñ —è–∫—ñ—Å–Ω–æ!'
  })
});
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î —Ä–µ–π—Ç–∏–Ω–≥ –≤–∏–∫–æ–Ω–∞–≤—Ü—è
```

## üóÑÔ∏è –ë–∞–∑–∞ –î–∞–Ω–∏—Ö

### –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –ú—ñ–≥—Ä–∞—Ü—ñ—é

```bash
# –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –¥–æ PostgreSQL
psql "$DATABASE_URL"

# –í–∏–∫–æ–Ω–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é
\i database/migrations/20251126_add_service_requests.sql

# –ê–±–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫
psql "$DATABASE_URL" < database/migrations/20251126_add_service_requests.sql
```

### –¢–∞–±–ª–∏—Ü—ñ
- `service_requests` - –∑–∞—è–≤–∫–∏ –Ω–∞ —Ä–æ–±–æ—Ç–∏
- `reviews` - –≤—ñ–¥–≥—É–∫–∏ (—Ä–æ–∑—à–∏—Ä–µ–Ω–æ –ø–æ–ª–µ–º `service_request_id`)

## üé® UI –°—Ç–æ—Ä—ñ–Ω–∫–∏

### –°—Ç–≤–æ—Ä–µ–Ω—ñ:
- ‚úÖ `/service-requests/create` - –§–æ—Ä–º–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞—è–≤–∫–∏
- üîÑ `/service-requests` - –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ (—Ç—Ä–µ–±–∞ –¥–æ—Ä–æ–±–∏—Ç–∏)
- üîÑ `/service-requests/[id]` - –î–µ—Ç–∞–ª—ñ –∑–∞—è–≤–∫–∏ (—Ç—Ä–µ–±–∞ –¥–æ—Ä–æ–±–∏—Ç–∏)
- üîÑ `/my/requests` - –ú–æ—ó –∑–∞—è–≤–∫–∏ (—Ç—Ä–µ–±–∞ –¥–æ—Ä–æ–±–∏—Ç–∏)

## üì± –ü—Ä–∏–∫–ª–∞–¥ UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤

### –ö–∞—Ä—Ç–∫–∞ –ó–∞—è–≤–∫–∏
```tsx
<div className="bg-white rounded-lg shadow p-6">
  <div className="flex items-start justify-between">
    <div className="flex-1">
      <h3 className="font-semibold text-lg">{request.title}</h3>
      <p className="text-gray-600 mt-1">{request.description}</p>
      <div className="flex items-center gap-4 mt-4 text-sm text-gray-500">
        <span>üìç {request.city}</span>
        <span>üí∞ {request.budgetFrom}-{request.budgetTo} –£–¶–ú</span>
        <span className={`px-3 py-1 rounded-full ${statusColors[request.status]}`}>
          {statusLabels[request.status]}
        </span>
      </div>
    </div>
  </div>
</div>
```

## üîî –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è

–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –ø—Ä–∏:
- ‚úÖ –ü—Ä–∏–π–Ω—è—Ç—Ç—ñ –∑–∞—è–≤–∫–∏ –≤–∏–∫–æ–Ω–∞–≤—Ü–µ–º
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ñ —Ä–æ–±–æ—Ç–∏
- ‚úÖ –û–ø–ª–∞—Ç—ñ –∫–ª—ñ—î–Ω—Ç–æ–º
- ‚úÖ –ù–æ–≤–æ–º—É –≤—ñ–¥–≥—É–∫—É

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### Prisma Schema
–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ —É `prisma/schema.prisma`:
- ‚úÖ –ú–æ–¥–µ–ª—å `ServiceRequest`
- ‚úÖ Enum `ServiceRequestStatus`
- ‚úÖ –ó–≤'—è–∑–æ–∫ `Review.serviceRequest`

### Regenerate Prisma Client
```bash
npx prisma generate
```

### Build and Deploy
```bash
npm run build
pm2 restart sviy-web
```

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –†–µ–π—Ç–∏–Ω–≥ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –Ω–æ–≤–æ–º—É –≤—ñ–¥–≥—É–∫—É:
- `avgRating` - —Å–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–π—Ç–∏–Ω–≥ (0.00 - 5.00)
- `totalReviews` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≥—É–∫—ñ–≤

### –ü—Ä–∏–∫–ª–∞–¥ –ó–∞–ø–∏—Ç—É –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```typescript
const stats = await prisma.review.groupBy({
  by: ['rating'],
  where: { reviewedId: userId, isVisible: true },
  _count: { rating: true }
});
// –†–µ–∑—É–ª—å—Ç–∞—Ç: { 1: 0, 2: 1, 3: 5, 4: 12, 5: 20 }
```

## üîê –ë–µ–∑–ø–µ–∫–∞

- ‚úÖ –¢—ñ–ª—å–∫–∏ –∞–≤—Ç–æ—Ä –º–æ–∂–µ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏/–≤–∏–¥–∞–ª—è—Ç–∏ —Å–≤–æ—é –∑–∞—è–≤–∫—É
- ‚úÖ –¢—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏ –º–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫
- ‚úÖ –û–¥–∏–Ω –≤—ñ–¥–≥—É–∫ –Ω–∞ –æ–¥–Ω—É –∑–∞—è–≤–∫—É
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å—É –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–Ω—è–º –£–¶–ú
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–∞ –æ–ø–ª–∞—Ç–∞ (atomic)

## üêõ Troubleshooting

### P2025: Record not found
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ ID —ñ—Å–Ω—É—î —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∞–≤–∞

### P2002: Unique constraint failed
–í—ñ–¥–≥—É–∫ –≤–∂–µ —ñ—Å–Ω—É—î –¥–ª—è —Ü—ñ—î—ó –ø–∞—Ä–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤/–∑–∞—è–≤–∫–∏

### Insufficient balance
–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –£–¶–ú –¥–ª—è –æ–ø–ª–∞—Ç–∏, –ø–æ–ø–æ–≤–Ω—ñ—Ç—å –±–∞–ª–∞–Ω—Å

---

## üéØ TODO (–©–æ –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏)

- [ ] –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ –∑–∞—è–≤–æ–∫
- [ ] –ß–∞—Ç –º—ñ–∂ –∫–ª—ñ—î–Ω—Ç–æ–º —Ç–∞ –≤–∏–∫–æ–Ω–∞–≤—Ü–µ–º
- [ ] Push-–Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- [ ] –§—ñ–ª—å—Ç—Ä–∏ —Ç–∞ –ø–æ—à—É–∫ –∑–∞—è–≤–æ–∫
- [ ] –ö–∞—Ä—Ç–∞ –∑ –ª–æ–∫–∞—Ü—ñ—î—é
- [ ] –ö–∞–ª–µ–Ω–¥–∞—Ä –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ–Ω–∞–≤—Ü—è
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è —Å—Ç–∞—Ä–∏—Ö –∑–∞—è–≤–æ–∫
- [ ] –°–∏—Å—Ç–µ–º–∞ –¥—ñ—Å–ø—É—Ç—ñ–≤
- [ ] –ü—Ä–µ–º—ñ—É–º-–∑–∞—è–≤–∫–∏ (–ø—Ä–æ—Å—É–≤–∞–Ω–Ω—è)
- [ ] –°—Ç—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –∑–∞—è–≤–æ–∫

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ**: 2025-11-26  
**–ê–≤—Ç–æ—Ä**: GitHub Copilot  
**–í–µ—Ä—Å—ñ—è API**: 1.0
